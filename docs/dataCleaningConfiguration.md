# 数据清洗配置详细文档

## 一、数据清洗概述

### 1.1 清洗目标
- **日期字段**: 统一日期格式，处理多种输入格式
- **金额字段**: 移除符号，统一数值格式，确保精度
- **文本字段**: 清理空字符、跨行符号、特殊字符

### 1.2 清洗时机
- **导入后清洗**: Excel数据导入到数据库后立即执行
- **批量清洗**: 支持对历史数据进行批量清洗
- **实时清洗**: 用户手动编辑数据时实时清洗

## 二、清洗规则配置

### 2.1 日期字段清洗规则

#### 2.1.1 支持的输入格式
```json
{
  "formats": [
    "YYYY-MM-DD",
    "YYYY/MM/DD", 
    "DD/MM/YYYY",
    "YYYY年MM月DD日",
    "YYYY.MM.DD",
    "MM/DD/YYYY",
    "DD-MM-YYYY"
  ],
  "output": "YYYY-MM-DD",
  "nullValues": ["", "无", "NULL", "null", "-", "N/A"]
}
```

#### 2.1.2 特殊处理规则
- **跨行符号处理**: 移除 `\n`, `\r\n`, `\r`
- **空格处理**: 移除前后空格
- **中文日期**: 支持"2023年12月25日"格式
- **不完整日期**: "2023-12"补全为"2023-12-01"

### 2.2 金额字段清洗规则

#### 2.2.1 符号移除配置
```json
{
  "remove_chars": ["¥", "$", "€", "￥", "元", "万", "千", ",", " ", "　"],
  "decimal_places": 2,
  "thousand_separator": ",",
  "decimal_separator": ".",
  "nullValues": ["", "无", "NULL", "null", "-", "N/A", "0"]
}
```

#### 2.2.2 数值转换规则
- **中文数字**: "一万二千" → "12000"
- **单位转换**: "12万" → "120000", "1.5千" → "1500"
- **科学计数法**: "1.2E+5" → "120000"
- **负数处理**: 支持"-"和"()"表示负数

### 2.3 文本字段清洗规则

#### 2.3.1 基础清洗配置
```json
{
  "trim": true,
  "remove_line_breaks": true,
  "normalize_spaces": true,
  "remove_special_chars": false,
  "nullValues": ["", "无", "NULL", "null", "-", "N/A", "暂无", "待定"]
}
```

#### 2.3.2 特殊字符处理
- **跨行符号**: `\n`, `\r\n`, `\r` → 空格
- **多余空格**: 连续空格 → 单个空格
- **全角字符**: 全角空格、标点 → 半角
- **控制字符**: 移除不可见控制字符

## 三、清洗执行机制

### 3.1 执行优先级
1. **优先级1**: 基础格式清洗（移除空格、跨行符号）
2. **优先级2**: 类型转换清洗（日期格式、数值格式）
3. **优先级3**: 业务规则清洗（单位转换、特殊值处理）

### 3.2 错误处理策略
- **格式错误**: 记录错误信息，保留原值
- **类型转换失败**: 标记为错误，需要人工处理
- **部分清洗成功**: 记录警告信息，应用成功的清洗

### 3.3 清洗日志记录
```json
{
  "fieldName": "contractAmount",
  "originalValue": "¥12,345.67元",
  "cleanedValue": "12345.67",
  "appliedRules": ["remove_currency", "remove_comma"],
  "status": "success",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## 四、配置管理

### 4.1 规则配置表结构
- **fieldName**: 字段名称
- **fieldType**: 字段类型（contract/procurement）
- **dataType**: 数据类型（date/number/text）
- **cleaningType**: 清洗类型
- **ruleConfig**: 清洗规则配置（JSON）
- **priority**: 执行优先级

### 4.2 动态配置更新
- 支持运行时更新清洗规则
- 新规则立即生效
- 历史数据可选择重新清洗

## 五、清洗效果验证

### 5.1 验证指标
- **清洗成功率**: 成功清洗的记录比例
- **错误率**: 清洗失败的记录比例
- **数据质量提升**: 清洗前后数据质量对比

### 5.2 质量检查
- **日期有效性**: 检查日期是否在合理范围内
- **金额合理性**: 检查金额是否为正数且在合理范围
- **文本完整性**: 检查关键文本字段是否为空

## 六、性能优化

### 6.1 批量处理
- 支持批量清洗，提高处理效率
- 分批处理大量数据，避免内存溢出
- 进度跟踪和中断恢复

### 6.2 缓存机制
- 清洗规则缓存，减少数据库查询
- 清洗结果缓存，避免重复处理
- 智能缓存失效机制
